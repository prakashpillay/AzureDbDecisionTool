<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Azure Database Decision Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body style="font-family: 'Inter', sans-serif; background: #f8f9fa; margin: 0; padding: 2rem;">
  <div style="max-width: 960px; margin: 0 auto; background: #fff; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
    <h1 style="text-align:center; font-size: 2rem; margin-bottom: 1.5rem;">Azure Database Decision Tool</h1>
    <div id="features"></div>
    <button onclick="calculateScores()" style="margin-top: 2rem; padding: 0.8rem 1.5rem; background: #007bff; color: white; font-size: 1rem; border: none; border-radius: 8px; cursor: pointer;">Get Recommendation</button>
    <div class="result" id="result" style="margin-top: 2rem; background: #e9f7ef; padding: 1rem; border-radius: 8px; border: 1px solid #c3e6cb;"></div>
    <canvas id="scoreChart" width="400" height="200" style="margin-top:2rem;"></canvas>
    <button onclick="downloadCSV()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #28a745; color: white; border: none; border-radius: 6px;">Export to CSV</button>
  </div>

  <script>
    const dbOptions = ["Azure Cosmos DB", "Azure SQL", "Azure PostgreSQL"];
    const links = {
      "Azure Cosmos DB": "https://learn.microsoft.com/en-us/azure/cosmos-db/introduction",
      "Azure SQL": "https://learn.microsoft.com/en-us/azure/azure-sql/database/",
      "Azure PostgreSQL": "https://learn.microsoft.com/en-us/azure/postgresql/"
    };
    const descriptions = {
      "Azure Cosmos DB": "A globally distributed, multi-model NoSQL database service with native support for JSON, multi-region writes, vector embeddings, and automatic scale.",
      "Azure SQL": "A fully managed relational database with high compatibility with SQL Server, ideal for traditional OLTP and enterprise workloads.",
      "Azure PostgreSQL": "Open-source, relational database with powerful features like JSONB, rich indexing, and extensions, best for open-source workloads."
    };
    const features = [
      { name: "JSON Document Support", scores: [3, 2, 2], explanation: "3 - Best support (Cosmos DB), 2 - Good (SQL/PostgreSQL)" },
      { name: "Relational Joins", scores: [1, 3, 3], explanation: "3 - Excellent (SQL/PostgreSQL), 1 - Not native in Cosmos DB" },
      { name: "Multi-region Write", scores: [3, 2, 1], explanation: "3 - Cosmos DB (native), 2 - SQL with effort, 1 - limited in PG" },
      { name: "Automatic Scaling", scores: [3, 2, 2], explanation: "3 - Cosmos DB native autoscale, others require config" },
      { name: "ACID Transactions", scores: [2, 3, 3], explanation: "3 - Full RDBMS compliance, 2 - Cosmos has limited ACID" },
      { name: "Vector Search Support", scores: [3, 2, 1], explanation: "3 - Cosmos DB with native vector, others newer" },
      { name: "OLTP Performance", scores: [2, 3, 3], explanation: "3 - Excellent in SQL/Postgres, 2 - Good for Cosmos (with design)" },
      { name: "Cost Optimization", scores: [2, 2, 3], explanation: "3 - PostgreSQL (open-source), 2 - SQL/Cosmos with autoscale tiers" },
      { name: "AI/ML Integration", scores: [3, 2, 2], explanation: "3 - Cosmos integrates vector & embeddings, 2 - others support via extensions" }
    ];

    function renderFeatures() {
      const container = document.getElementById("features");
      features.forEach((f, i) => {
        const row = document.createElement("div");
        row.style = "display:flex; justify-content:space-between; align-items:center; padding:0.75rem 0; border-bottom:1px solid #ddd;";
        row.innerHTML = `
          <div style="flex:1.5">
            <strong>${f.name}</strong>
            <div style="font-size: 0.85rem; color: #555;">${f.explanation}</div>
          </div>
          <div style="flex:1">
            <select id="importance-${i}" style="padding: 0.4rem; border-radius: 6px; border: 1px solid #ccc; width: 100%;">
              <option value="0">0 - Not Important</option>
              <option value="1">1 - Low</option>
              <option value="2">2 - Medium</option>
              <option value="3">3 - High</option>
            </select>
          </div>
        `;
        container.appendChild(row);
      });
    }

    function calculateScores() {
      const totals = [0, 0, 0];
      features.forEach((f, i) => {
        const imp = parseInt(document.getElementById(`importance-${i}`).value);
        f.scores.forEach((score, dbIdx) => {
          totals[dbIdx] += score * imp;
        });
      });
      const ranked = dbOptions.map((name, idx) => ({ name, score: totals[idx] }))
                              .sort((a, b) => b.score - a.score);
      let output = `<h3>Recommendation</h3><ol>`;
      ranked.forEach((r, i) => {
        output += `<li><strong>${r.name}</strong> â€” Score: ${r.score}<br/><em>${descriptions[r.name]}</em><br/><a href='${links[r.name]}' target='_blank'>More details</a></li>`;
      });
      output += `</ol>`;
      document.getElementById("result").innerHTML = output;

      const ctx = document.getElementById('scoreChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: dbOptions,
          datasets: [{
            label: 'Database Scores',
            data: totals,
            backgroundColor: ['#007bff', '#17a2b8', '#28a745']
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    function downloadCSV() {
      let csv = 'Feature,Importance,Cosmos DB,SQL,PostgreSQL\n';
      features.forEach((f, i) => {
        const imp = document.getElementById(`importance-${i}`).value;
        csv += `${f.name},${imp},${f.scores[0]},${f.scores[1]},${f.scores[2]}\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'database_decision_scores.csv';
      a.click();
    }

    renderFeatures();
  </script>
</body>
</html>
